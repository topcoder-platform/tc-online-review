/*
 * Copyright (C) 2011-2014 TopCoder Inc., All Rights Reserved.
 */
package com.cronos.onlinereview;


/**
 * Online review functional tests 4, testing screen phase cannot open  without submission.
 *
 * @author TCSASSEMBLER
 * @version 2.0
 */
public class ScreenPhaseCannotOpenTests extends ProjectTests {


    /**
     * Test Case Number: FTC147 RS10.2 Verify timeline advancement for a Contest without submission
     *
     * @throws Exception if any error occurs
     */
    public void testScreenPhaseCannotOpen() throws Exception {
        // login as manager
        TestHelper.loginUser(browser);
        // open the project details page
        browser.open(TestHelper.getBaseURL() + TestHelper.getProjectURL() + projectId);

        // open spec submission phase
        TestHelper.OpenPhaseByUI(browser, 1, "Specification Submission");
        // Add spec submitter role
        TestHelper.addRoles(browser, "Specification Submitter", TestHelper.getUsername());
        // Add spec reviewer role
        TestHelper.addRoles(browser, "Specification Reviewer", TestHelper.getUsername());
        // Upload specification
        browser.click("//table[@id='myRolesTable']/tbody/tr[2]/td[2]/a/b");
        browser.waitForPageToLoad(TIMEOUT);
        browser.type("file", TestHelper.getUploadFilePath());
        browser.click("//input[@alt='Upload']");
        browser.waitForPageToLoad(TIMEOUT);
        // close spec submission phase
        TestHelper.ClosePhaseByUI(browser, 1, "Specification Submission");

        // open spec review phase
        TestHelper.OpenPhaseByUI(browser, 2, "Specification Review");
        
        // submit specification review
        TestHelper.submitScorecard(browser, "4 - Strongly Agree", "Return to Project Details", true);

        // close spec review phase
        TestHelper.ClosePhaseByUI(browser, 2, "Specification Review");

        // open registration phase
        TestHelper.OpenPhaseByUI(browser, 3, "registration");

        // open submission phase
        TestHelper.OpenPhaseByUI(browser, 4, "submission");

        // Add submitter role
        TestHelper.addRoles(browser, "Submitter", TestHelper.getCompetitorUsername());

        // Close registration phase
        TestHelper.ClosePhaseByUI(browser, 3, "registration");

        // Close submission phase
        TestHelper.ClosePhaseByUI(browser, 4, "submission");

        // open screening phase
        TestHelper.OpenPhaseByUI(browser, 6, "submission");

        //Check the screening phase can not be opened
        assertTrue("error occurs!", browser.isTextPresent("There were validation errors. See below."));
        assertTrue("error occurs!", browser.isTextPresent("Cannot open the Screening phase"));
        //Check the Post-Mortem phase is added
        assertTrue("Post-Mortem phase should be added", browser.isTextPresent("Post-Mortem"));

        // Click 'cancel'
        browser.click("//img[@alt='Cancel']");
        browser.waitForPageToLoad(TIMEOUT);
        assertNoErrorsOccurred();
    }




}
